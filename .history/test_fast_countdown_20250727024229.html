<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Countdown & Section Navigation Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body class="text-white">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-6">Fast Countdown & Section Test</h1>
        <p class="text-lg mb-4">Testing: Smaller/faster countdown that only shows once per module</p>
        
        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Module Navigation Test</h2>
            <div class="space-y-3">
                <button onclick="testNewModule()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded mr-3">
                    ğŸš€ Test New Module (Should show countdown)
                </button>
                <button onclick="testSectionChange()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded mr-3">
                    ğŸ“ Test Section Change (No countdown)
                </button>
                <button onclick="clearSession()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
                    ğŸ—‘ï¸ Clear Session (Reset countdown state)
                </button>
            </div>
        </div>

        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Expected Behavior:</h2>
            <ul class="list-disc list-inside space-y-2 text-sm">
                <li>âœ… Countdown: 220x220px (was 300x300px)</li>
                <li>âœ… Duration: 2 seconds (was 3 seconds)</li>
                <li>âœ… Speed: 600ms intervals (was 1000ms)</li>
                <li>âœ… Sequence: 2 â†’ 1 â†’ ğŸš€ (was 3 â†’ 2 â†’ 1 â†’ ğŸš€)</li>
                <li>âœ… Module entry: Shows countdown once</li>
                <li>âœ… Section changes: No countdown</li>
                <li>âœ… Session tracking: Uses sessionStorage</li>
            </ul>
        </div>

        <div id="status-display" class="mt-6 bg-black/20 rounded-lg p-4">
            <h3 class="font-semibold mb-2">Current Status:</h3>
            <div id="status-text">Ready to test...</div>
        </div>
    </div>

    <script src="user/js/cv-eye-tracking.js"></script>
    <script>
        let currentTracker = null;

        function updateStatus(message) {
            document.getElementById('status-text').innerHTML = message;
        }

        async function testNewModule() {
            updateStatus('ğŸš€ Testing NEW MODULE - should show compact countdown...');
            
            // Stop current tracker if exists
            if (currentTracker) {
                await currentTracker.stopTracking();
            }
            
            // Clear session for this test to simulate new module entry
            sessionStorage.removeItem('eyetracking_countdown_test_module_new');
            
            // Create new tracker for a "new" module
            currentTracker = new CVEyeTrackingSystem('test_module_new', 'section_1');
            
            updateStatus('ğŸš€ New module tracker initialized - compact countdown should have appeared!');
        }

        async function testSectionChange() {
            updateStatus('ğŸ“ Testing SECTION CHANGE - should NOT show countdown...');
            
            // Stop current tracker if exists
            if (currentTracker) {
                await currentTracker.stopTracking();
            }
            
            // Create tracker for same module, different section (no countdown)
            currentTracker = new CVEyeTrackingSystem('test_module_new', 'section_2');
            
            updateStatus('ğŸ“ Section change completed - no countdown should have appeared!');
        }

        function clearSession() {
            // Clear all eye tracking session data
            const keys = Object.keys(sessionStorage);
            keys.forEach(key => {
                if (key.startsWith('eyetracking_countdown_')) {
                    sessionStorage.removeItem(key);
                }
            });
            
            updateStatus('ğŸ—‘ï¸ Session cleared - next module test will show countdown again');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('Ready! Click "Test New Module" to see the compact, fast countdown.');
        });
    </script>
</body>
</html>
